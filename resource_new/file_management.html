<!doctype html>
<html>
<head>
<meta charset="UTF-8">

<script>  

// function loadFiles() {    
//     fetch('/Update_File') // 发送GET请求到您的服务器端点    
//         .then(response => {
//             console.log(response); // 直接打印响应对象到控制台
//             return response.text(); // 将响应对象转换为文本
//         })
//         .then(data => {
//             console.log(data); // 打印响应文本到控制台
//         })
//         .catch(error => {    
//             console.error('Error fetching file information:', error);    
//         });    
// }


  function loadFiles() {    
      fetch('/Update_File') // 发送GET请求到您的服务器端点    
          .then(response => response.json()) // 解析服务器返回的JSON响应    
          .then(data => {    
              // 清空表格内容    
              let tableBody = document.getElementById('fileTableBody'); // 使用ID选择tbody元素以提高性能    
              tableBody.innerHTML = '';    
      
              // 遍历服务器返回的文件信息，并添加到表格中    
              data.forEach(file => {    
                  let row = document.createElement('tr');    
                  let fileNameCell = document.createElement('td');    
                  let fileModifiedCell = document.createElement('td');    
                  let fileActionCell = document.createElement('td'); // 添加一个新的单元格用于“下载”和“删除”按钮    
                    
                  fileNameCell.textContent = file.name;    
                    
                  // 解析和格式化时间字段    
                  let lastModifiedDate = new Date(file.lastModified.trim()); // 使用trim()去除可能的换行符或其他空白字符    
                  fileModifiedCell.textContent = lastModifiedDate.toLocaleString(); // 使用toLocaleString()以一种更友好的方式显示时间    
                    
                  // 添加“下载”和“删除”按钮    
                  let downloadButton = document.createElement('a');    
                  downloadButton.href = '#'; // 这里应该设置为实际的下载链接或触发下载的逻辑    
                  downloadButton.textContent = '下载';    
                  downloadButton.setAttribute('data-toggle', 'modal');    
                  downloadButton.setAttribute('data-target', '#myModal');    
                  let deleteButton = document.createElement('a');    
                  deleteButton.href = '#'; // 这里应该设置为实际的删除链接或触发删除的逻辑    
                  deleteButton.textContent = '删除';    
                  fileActionCell.appendChild(downloadButton);    
                  fileActionCell.appendChild(document.createTextNode(' ')); // 添加一个空格分隔符    
                  fileActionCell.appendChild(deleteButton);    
                    
                  row.appendChild(fileNameCell);    
                  row.appendChild(fileModifiedCell);    
                  row.appendChild(fileActionCell); // 添加操作单元格到行中    
                  tableBody.appendChild(row);    
              });    
          })    
          .catch(error => {    
              console.error('Error fetching file information:', error);    
          });    
  }  

  function uploadFile() {
    // 这里编写上传文件的逻辑，可以通过 fetch 或者其他适合的方式来发送文件给服务器
    const formData = new FormData();
    const fileInput = document.getElementById('fileToUpload');
    formData.append('file', fileInput.files[0]);

    fetch('/upload', {
        method: 'POST',
        body: formData
    })
    .then(response => {
        if (!response.ok) {
            throw new Error('Failed to upload file');
        }
        // 上传成功后刷新文件列表
        loadFiles();
        // 关闭上传模态框
        $('#myModal2').modal('hide');
    })
    .catch(error => {
        console.error('Error uploading file:', error);
    });
  }

  function downloadAllFiles() {
      // 这里编写全部下载文件的逻辑，可以通过 fetch 或者其他适合的方式从服务器下载所有文件
  }
</script>


<title>后台文件管理</title>
<script src="js/jquery.js"></script>
<!-- <link href="css/font-awesome.css" rel="stylesheet"> -->
<link href="css/bootstrap.css" rel="stylesheet">
<link href="css/style-responsive.css" rel="stylesheet">
<link href="css/default-theme.css" rel="stylesheet">
<link href="css/style.css" rel="stylesheet">
<link href="css/bootstrap-reset.css" rel="stylesheet">
<link href="font-awesome-4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
<link rel="stylesheet" type="text/css" href="./font_0xkdkw2em4fr/iconfont.css">
<script src="./font_0xkdkw2em4fr/iconfont.js"></script>
<script src="./font_wf3s9k9sr1c/iconfont.js"></script>
<style>
  .icon {
    width: 1em;
    height: 1em;
    vertical-align: -0.15em;
    fill: currentColor;
    overflow: hidden;
  }
  .aaa{
    display: inline-block;
    width: 5px;
    height: 1px;
  }
  .kouhao {
    margin-left: 10px;
  }
  .bbb {
    display: inline-block;
    margin-left: 100px;
  }
  </style>
</head>


<body class="sticky-header">
  <div class="sidebar-left">
    <div class="sidebar-left-info">
      <div class=" search-field"> </div>
      <ul class="nav nav-pills nav-stacked side-navigation">
        <!-- <li class="menu-list nav-active"> <a href=""><i class="fa fa-drivers-license"></i> <span>周报管理</span></a> -->
          <li class="menu-list nav-active"> <a href=""><svg class="icon" aria-hidden="true">
              <use xlink:href="#icon-mingpian"></use>
            </svg><span class="aaa"></span><span>周报管理</span><span class="bbb"><svg class="icon" aria-hidden="true">
              <use xlink:href="#icon-xiala"></use>
            </svg></span></a>
            <ul class="child-list">
              <li class="active"><a href="file_management.html">周报文件</a></li>
          </ul>


          <li class="menu-list nav-active"> <a href=""><svg class="icon" aria-hidden="true">
              <use xlink:href="#icon-mingpian"></use>
            </svg><span class="aaa"></span><span>文件共享</span><span class="bbb"><svg class="icon" aria-hidden="true">
              <use xlink:href="#icon-xiala"></use>
            </svg></span></a>
            <ul class="child-list">
              <li class="active"><a href="video.html">视频文件</a></li>
              <li class="active"><a href="picture.html">图片文件</a></li>
          </ul>





      </ul>
    </div>
  </div>
  <div class="body-content" >
    <div class="header-section">
      <div class="logo dark-logo-bg"> <a href="file_management.html"> <img src="img/logo-icon.png" alt=""> 
        <!--<i class="fa fa-maxcdn"></i>--> 
        <span class="brand-name" style="font-size: 15px; font-weight: bold;">后台文件管理</span> </a> </div>
      <div class="icon-logo dark-logo-bg hidden-xs hidden-sm"> <a href="file_management.html"><img src="img/logo-icon.png" alt=""> </a> </div>
      <!-- <a class="toggle-btn"><i class="fa fa-outdent"></i></a> -->
      <div class="kouhao">实验室</div>
      <div class="notification-wrap">
        <div class="right-notification">
          <ul class="notification-menu">
            <li  class="dropdown">
				<a href="javascript:;" data-toggle="dropdown" class="dropdown-toggle" aria-expanded="false">  账号设置 </a>
				
			  <ul role="menu" class="dropdown-menu language-switch">
            <li>
                <a  href="修改密码.html">修改密码</a>
            </li>                    
        </ul>
			  </li>
            <li> <a href="javascript:;" class="btn btn-default  dropdown-toggle"> 退出登录 </a> </li>
          </ul>
        </div>
      </div>
    </div>
    <div class="page-head">
      <ol class="breadcrumb">
        <li><a href="#">周报管理</a></li>
        <li  class="active">周报文件</li>
      </ol>
      <h3>周报文件</h3>
    </div>



<div class="wrapper">  
      <div class="panel">  
          <div class="panel-body">  
              <a href="#" class="btn btn-primary" data-toggle="modal" data-target="#myModal2">上传文件</a>  
              <a href="#" class="btn btn-primary" data-toggle="modal" data-target="#myModal3">全部下载</a>  
          </div>  
      </div>  
      <table class="table m-t-20">  
          <thead>  
              <tr>  
                  <th>文件名</th>  
                  <th>文件修改时间</th>  
                  <th>操作</th> <!-- 添加了一个表头用于“下载”和“删除”按钮 -->  
              </tr>  
          </thead>  
          <tbody id="fileTableBody"></tbody> <!-- 给tbody一个ID以便更容易地选择它 -->  
      </table>  
</div>  
  <script>  
  // 页面加载完成后调用 loadFiles 函数  
  window.onload = loadFiles;  
  </script>
  </div>
</section>
	


<!-- Modal -->
<!-- 模态框 -->
<div id="myModal2" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <!-- 模态框内容 -->
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        <h4 class="modal-title">上传文件</h4>
      </div>
      <div class="modal-body">
        <form id="uploadForm" enctype="multipart/form-data">
          <input type="file" name="fileToUpload" id="fileToUpload">
          <input type="button" value="上传" onclick="uploadFile()">
        </form>
      </div>
    </div>
  </div>
</div>

<div id="myModal3" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <!-- 模态框内容 -->
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        <h4 class="modal-title">全部下载</h4>
      </div>
      <div class="modal-body">
        <button onclick="downloadAllFiles()">下载全部文件</button>
      </div>
    </div>
  </div>
</div>

	
	



</script>  


<script src="js/bootstrap.js"></script> 
<script src="js/echarts.min.js"></script> 
<script src="js/scripts.js"></script> 
<script src="laydate/laydate.js"></script> 
<script>
lay('#version').html('-v'+ laydate.v);
laydate.render({
    elem: '#test1'
  ,range: true
  ,theme: '#1890ff'
});
</script>
 <div
 style="text-align: center; position: fixed; bottom: 0; width: 100%; line-height: 150%; background: #f5f5f5; border-top: 1px solid #ddd; z-file_show:10000; font-size: 12px;">
 维护<a style="color:blue" target="_blank"
</div>
</body>
</html>
